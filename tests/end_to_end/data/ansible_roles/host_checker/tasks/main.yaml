# -------- Task to identify whether the validation step fails or not. --------
- name: Set flag and informative variable
  set_fact:
    check_result: 'false'
    errors: ''
# ----------------------------------------------------------------------------

# -------- Checks ------------------------------------------------------------
- name: Check Python
  import_tasks: check_python.yaml

- name: Check OS
  import_tasks: check_os.yaml

- name: Check the status of Wazuh components
  import_tasks: check_wazuh_components.yaml

- name: Check the connection between Filebeat and Wazuh Indexer
  import_tasks: check_filebeat_indexer.yaml

- name: Check the connection between Controller node and Wazuh Indexer
  import_tasks: check_controller_indexer.yaml
# ----------------------------------------------------------------------------

# -------- Task to identify whether the validation step fails or not. --------
- set_fact:
    phase_results: "{{ errors }}"
    cacheable: yes

- name: Verify if any check have failed
  fail:
    msg: "Some validations were fail:\n'{{ errors }}'"
  when: (check_result == 'true' or errors != '')
# ----------------------------------------------------------------------------
