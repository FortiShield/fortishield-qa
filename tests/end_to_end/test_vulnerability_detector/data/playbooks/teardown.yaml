- name: Cleanup environment
  hosts: wazuh-agent
  tasks:

    - name: Uninstall vim vulnerable package
      become: true
      command: apt-get remove vim -y

    - name: Delete agent configuration
      become: true
      blockinfile:
        path: /var/ossec/etc/ossec.conf
        block: ''
        marker: <!-- {mark} ANSIBLE MANAGED BLOCK -->

- name: Cleanup environment
  hosts: wazuh-windows
  tasks:

    - name: Uninstall Mozilla Firefox vulnerable package
      ansible.windows.win_shell: |
        Start-Process "C:\Program Files\Mozilla Firefox\uninstall\helper.exe" -ArgumentList "/S" -Wait

    - name: Restore ossec.conf without changes
      ansible.windows.win_copy:
        src: C:\temp\ossec.conf
        dest: C:\Program Files (x86)\ossec-agent
        remote_src: yes

    - name: Delete C:\temp folder
      ansible.windows.win_file:
        path: C:\temp
        state: absent

    - name: Restart wazuh-agent (Windows)
      ansible.windows.win_shell: |
        net stop wazuh
        net start wazuh