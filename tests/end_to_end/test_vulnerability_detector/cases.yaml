- case: "Installation of a vulnerable package"
  id: "install_package"
  description: "Installation of a vulnerable package"
  preconditions: null
  body:
    tasks:
      - operation: install_package
        target: agent
        package:
          centos:
            amd64: https://downloads.rclone.org/v1.49.5/rclone-v1.49.5-linux-amd64.rpm
            arm: https://download.postgresql.org/pub/repos/yum/11/redhat/rhel-7-aarch64/postgresql11-libs-11.17-2PGDG.rhel7.aarch64.rpm
          ubuntu:
            amd64: https://downloads.rclone.org/v1.49.5/rclone-v1.49.5-linux-amd64.deb
            arm: https://grafana.com/grafana/download/8.5.5?edition=enterprise&platform=arm
          windows:
            amd64: https://get.videolan.org/vlc/3.0.6/win64/vlc-3.0.6-win64.exe
          macos:
            amd64: https://nodejs.org/dist/v17.0.1/node-v17.0.1.pkg
      - operation: check_agent_vulnerability
        target: manager
        parameters:
          alert: True
          alert_indexed: False
          api: False
          state_indice: False
        vulnerability_data:
          centos:
            amd64:
                PACKAGE_NAME: "rclone"
                PACKAGE_VERSION: "1.49.5-1"
                CVE: ["CVE-2020-28924"]
                ARCHITECTURE: 'x86_64'
            arm:
                PACKAGE_NAME: "postgresql11-libs"
                PACKAGE_VERSION: "11.17.2"
                CVE: ["CVE-2020-28924"]
                ARCHITECTURE: 'arm64'
          ubuntu:
            amd64:
                PACKAGE_NAME: "rclone"
                PACKAGE_VERSION: "1.49.5-1"
                CVE: ["CVE-2020-28924"]
                ARCHITECTURE: 'x86_64'
            arm:
                PACKAGE_NAME: "grafana"
                PACKAGE_VERSION: "8.5.5-1"
                CVE: ["CVE-2020-28924"]
                ARCHITECTURE: 'arm64'
          windows:
            amd64:
                PACKAGE_NAME: "vlc"
                PACKAGE_VERSION: "3.0.6-1"
                CVE: ["CVE-2020-28924"]
                ARCHITECTURE: 'x86_64'
          macos:
            amd64:
                PACKAGE_NAME: "node"
                PACKAGE_VERSION: "17.0.1"
                CVE: ["CVE-2020-28924"]
                ARCHITECTURE: 'x86_64'

    # check_alerts:
    #     centos:
    #       amd64:
    #         - event: syscollector_install_package_alert_yum
    #           parameters:
    #             PACKAGE_NAME: "rclone"
    #             PACKAGE_VERSION: "1.49.5"
    #       arm:
    #         - event: syscollector_install_package_alert_yum
    #           parameters:
    #             PACKAGE_NAME: "rclone"
    #             PACKAGE_VERSION: "1.49.5"
    #     ubuntu:
    #       amd64:
    #         - event: syscollector_install_package_alert_apt
    #           parameters:
    #             PACKAGE_NAME: "rclone"
    #             PACKAGE_VERSION: "1.49.5"
    #       arm:
    #         - event: syscollector_install_package_alert_apt
    #           parameters:
    #             PACKAGE_NAME: "rclone"
    #             PACKAGE_VERSION: "1.49.5"
    #     windows:
    #       amd64:
    #         - event: syscollector_install_package_alert_apt
    #           parameters:
    #             PACKAGE_NAME: "VideoLAN"
    #             PACKAGE_VERSION: "3.0.6"
    #     macos:
    #       amd64:
    #         - event: syscollector_install_package_alert_apt
    #           parameters:
    #             PACKAGE_NAME:
    #             PACKAGE_VERSION:
  # teardown:
    # - remove_package:
    #     package:
    #       centos:
    #         amd: rclone
    #         arm: rclone
    #       ubuntu:
    #         amd: rclone
    #         arm: rclone
    #       windows:
    #         amd64: C:\\\\Program Files\\\\VideoLAN\\\\VLC\\\\uninstall.exe
    #       macos:
    #         amd64:

# - case: "Updating a vulnerable package that remains vulnerable to the same CVE"
#   id: "update_vuln_package_remain_vulnerable"
#   description: "Updating a vulnerable package that remains vulnerable to the same CVE"
#   preconditions:
#       tasks:
#         - install_package:
#             package:
#               centos:
#                 amd64: https://downloads.rclone.org/v1.49.5/rclone-v1.49.5-linux-amd64.rpm
#               ubuntu:
#                 amd64: https://downloads.rclone.org/v1.49.5/rclone-v1.49.5-linux-amd64.deb
#       check_alerts:
#           centos:
#             - event: syscollector_install_package_alert_yum
#               parameters:
#                 PACKAGE_NAME: "rclone"
#                 PACKAGE_VERSION: "1.49.5"
#           ubuntu:
#             - event: syscollector_install_package_alert_apt
#               parameters:
#                 PACKAGE_NAME: "rclone"
#                 PACKAGE_VERSION: "1.49.5"
#   body:
#     tasks:
#       - install_package:
#           package:
#             centos:
#               amd64: https://downloads.rclone.org/v1.50.0/rclone-v1.50.0-linux-amd64.rpm
#             ubuntu:
#               amd64: https://downloads.rclone.org/v1.50.0/rclone-v1.50.0-linux-amd64.deb
#     check_alerts:
#         centos:
#           - event: syscollector_upgrade_package_alert_yum
#             parameters:
#               PACKAGE_NAME: "rclone"
#               PACKAGE_VERSION: "1.50.0"
#         ubuntu:
#           - event: syscollector_install_package_alert_apt
#             parameters:
#               PACKAGE_NAME: "rclone"
#               PACKAGE_VERSION: "1.50.0"
#   teardown:
#     - remove_package:
#         package:
#           centos: rclone
#           ubuntu: rclone

#  ----

# - case: "Updating a vulnerable package that becomes vulnerable to another CVE"
#   id: "update_vuln_package_additional_vulnerablility"
#   description: "Updating a vulnerable package that becomes vulnerable to another CVE"
#   preconditions:
#       tasks:
#         - install_package:
#             package:
#               centos: https://nmap.org/dist/nmap-6.47-1.x86_64.rpm
#               ubuntu: https://sourceforge.net/projects/webadmin/files/webmin/1.999/webmin_1.999_all.deb/download
#       check_alerts:
#           centos:
#             - event: install_package
#               name: "nmap"
#               version: "6.47"
#           ubuntu:
#               - event: install_package
#                 name: "webmin"
#                 version: "1.999"
#   body:
#     tasks:
#       - install_package:
#           package:
#             centos: https://nmap.org/dist/nmap-7.00-1.x86_64.rpm
#             ubuntu: https://sourceforge.net/projects/webadmin/files/webmin/1.999/webmin_2.000_all.deb/download
#     check_alerts:
#         centos:
#           - event: upgrade_package
#             name: "nmap"
#             version: "7.00"
#         ubuntu:
#             - event: upgrade_package
#               name: "webmin"
#               version: "2.000"
#   teardown:
#     - remove_package:
#         package:
#           centos: nmap
#           ubuntu: webmin


# ------------------------

# - case: "Vulnerable package that update is also vulnerable to another CVE"
#   id: "update_vuln_package_additional_vulnerablility"
#   description: "Vulnerable package that update is also vulnerable to another CVE"
#   preconditions:
#       tasks:
#         - install_package:
#             package:
#               centos: https://repo.mongodb.org/yum/redhat/7/mongodb-org/4.2/x86_64/RPMS/mongodb-org-server-4.2.11-1.el7.x86_64.rpm
#               ubuntu: https://repo.mongodb.org/apt/ubuntu/dists/bionic/mongodb-org/4.2/multiverse/binary-amd64/mongodb-org-server_4.2.11_amd64.deb
#       check_alerts:
#           centos:
#             - event: install_package
#               name: "mongodb"
#               version: "4.2.11"
#           ubuntu:
#             - event: install_package
#               name: "mongodb"
#               version: "4.2.11"
#   body:
#     tasks:
#       - install_package:
#           package:
#             centos: https://repo.mongodb.org/yum/redhat/7/mongodb-org/4.4/x86_64/RPMS/mongodb-org-server-4.4.10-1.el7.x86_64.rpm
#             ubuntu: https://repo.mongodb.org/apt/ubuntu/dists/focal/mongodb-org/4.4/multiverse/binary-amd64/mongodb-org-server_4.4.10_amd64.deb
#     check_alerts:
#         centos:
#           - event: upgrade_package
#             name: "mongodb"
#             version: "4.4.10"
#         ubuntu:
#           - event: upgrade_package
#             name: "mongodb"
#             version: "4.4.10"
#   teardown:
#     - remove_package:
#         package:
#           centos: mongodb
#           ubuntu: mongodb


# - case: "Vulnerable package that update cease to be vulnerable"
#   id: "update_vuln_package_cease_vuln"
#   description: "Vulnerable package that update cease to be vulnerable"
#   preconditions:
#       tasks:
#         - install_package:
#             package:
#               centos: https://master.dl.sourceforge.net/project/webadmin/webmin/2.003/webmin-2.003-1.noarch.rpm
#               ubuntu: https://master.dl.sourceforge.net/project/webadmin/webmin/2.003/webmin_2.003_all.deb
#       check_alerts:
#           centos:
#             - event: install_package
#               name: "webmin"
#               version: "2.003"
#           ubuntu:
#             - event: install_package
#               name: "webmin"
#               version: "2.003"
#   body:
#     tasks:
#       - install_package:
#           package:
#             centos: https://kumisystems.dl.sourceforge.net/project/webadmin/webmin/2.000/webmin-2.000-1.noarch.rpm
#             ubuntu: https://altushost-swe.dl.sourceforge.net/project/webadmin/webmin/2.000/webmin_2.000_all.deb
#     check_alerts:
#         centos:
#           - event: upgrade_package
#             name: "webmin"
#             version: "2.000"
#         ubuntu:
#           - event: upgrade_package
#             name: "webmin"
#             version: "2.000"
#   teardown:
#     - remove_package:
#         package:
#           centos: webmin
#           ubuntu: webmin




#  "Deleting a vulnerable package"



# - case: "Installation of a non-vulnerable package"



# - case: "Updating a non-vulnerable package that becomes vulnerable"



# Updating of a non-vulnerable package that remains non-vulnerable



# Deletion of a non-vulnerable package
