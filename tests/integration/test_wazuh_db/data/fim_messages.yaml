---
-
  name: "Basics success"
  description: "Check success use cases (save2, load and delete)"
  test_case:
  -
    input: "agent 001 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
    output: "ok"
    stage: "Syscheck save2 success"
  -
    input: "agent 001 syscheck load /home/test/file2"
    output: "ok 0:rw-r--r--:0:0:d41d8cd98f00b204e9800998ecf8427e:da39a3ee5e6b4b0d3255bfef95601890afd80709:root:root:1575421292:16879:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855:!1:1575421292"
    stage: "Syscheck save2 load success"
  -
    input: "agent 001 syscheck load /home/test/file"
    output: "ok "
    stage: "Syscheck load success"
  -
    input: "agent 001 syscheck delete /home/test/file2"
    output: "ok"
    stage: "Syscheck delete success"
  -
    input: "agent 001 syscheck load /home/test/file2"
    output: "ok "
    stage: "Syscheck delete load success"
-
  name: "Syntax errors"
  description: "Invalid syntax errors (save2, load and delete)"
  test_case:
  -
    input: "agent 002 syscheck delete"
    output: "err Invalid FIM query syntax, near 'delete'"
    stage: "Syscheck delete invalid syntax"
  -
    input: "agent 002 syscheck save2"
    output: "err Invalid FIM query syntax, near 'save2'"
    stage: "Syscheck save2 invalid syntax"
  -
    input: "agent 002 syscheck load"
    output: "err Invalid FIM query syntax, near 'load'"
    stage: "Syscheck load invalid syntax"
  -
    input: "agent 001 syscheck integrity_check_global"
    output: "err Invalid FIM query syntax, near 'integrity_check_global'"
    stage: "Syscheck integrity_check_global fail - invalid syntax"
  -
    input: "agent 001 syscheck integrity_check_left"
    output: "err Invalid FIM query syntax, near 'integrity_check_left'"
    stage: "Syscheck integrity_check_left fail - invalid syntax"
  -
    input: "agent 001 syscheck integrity_clear"
    output: "err Invalid FIM query syntax, near 'integrity_clear'"
    stage: "Syscheck integrity_clear fail - invalid syntax"
-
  name: "Save2 fails"
  description: "Check save2 fail use cases"
  test_case:
  -
    input: "agent 002 syscheck save2 {\"path\":\"/home/test/file2\"\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
    output: "err Cannot save Syscheck"
    stage: "Syscheck save2 fail: Bad JSON"
  -
    input: "agent 002 syscheck save2 {\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
    output: "err Cannot save Syscheck"
    stage: "Syscheck save2 fail: no path"
  -
    input: "agent 002 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":\"asdf\",\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
    output: "err Cannot save Syscheck"
    stage: "Syscheck save2 fail: Bad (or no) timestamp"
  -
    input: "agent 001 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":1575421292}"
    output: "err Cannot save Syscheck"
    stage: "Syscheck save2 fail: No attributes"
  -
    input: "agent 001 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":1575421292,\"attributes\":{\"\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
    output: "err Cannot save Syscheck"
    stage: "Syscheck save2 fail: Null attribute field (sqlite3_step fail)"
  -
    input: "agent 001 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":1575421292,\"attributes\":{\"file\":null,\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
    output: "err Cannot save Syscheck"
    stage: "Syscheck save2 fail: Null attribute value (sqlite3_step fail and reset)"
  -
    input: "agent 001 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":1575421292,\"attributes\":{\"unknown_field\":\"unknown_value\",\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
    output: "err Cannot save Syscheck"
    stage: "Syscheck save2 fail: Unknown attribute field"
-
  name: "Integrity_check_global success"
  description: "Integrity_check_global success"
  test_case:
  -
    input: "agent 001 syscheck save2 {\"path\":\"/home/test/file1\",\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
    output: "ok"
    stage: "Syscheck integrity_check_global preparation file1"
  -
    input: "agent 001 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
    output: "ok"
    stage: "Syscheck integrity_check_global preparation file2"
  -
    input: "agent 001 syscheck integrity_check_global {\"begin\":\"/home/test/file1\",\"end\":\"/home/test/file2\",\"checksum\":\"2a41be94762b4dc57d98e8262e85f0b90917d6be\",\"id\":1}"
    output: "ok "
    stage: "Syscheck integrity_check_global success"
  -
    input: "agent 001 syscheck integrity_check_global {\"begin\":\"/home/test/file1\",\"end\":\"/home/test/file2\",\"checksum\":\"asdf1234\",\"id\":1}"
    output: "ok checksum_fail"
    stage: "Syscheck integrity_check_global fail - checksum_fail"
  -
    input: "agent 001 syscheck integrity_check_global {\"begin\":\"/home/test/f1\",\"end\":\"/home/test/f2\",\"checksum\":\"1234\",\"id\":1}"
    output: "ok no_data"
    stage: "Syscheck integrity_check_global success - no data"
  -
    input: "agent 001 syscheck load /home/test/f1"
    output: "ok "
    stage: "Syscheck Integrity_check_global load success"
  -
    input: "agent 001 syscheck integrity_check_global {\"begin\":\"/home/test/file1\",\"end\":\"/home/test/file2\",\"checksum\":\"2a41be94762b4dc57d98e8262e85f0b90917d6be\",\"id\":1}"
    output: "ok no_data"
    stage: "Syscheck integrity_check_global success - no data"
-
  name: "Integrity_check_global fails"
  description: "Integrity_check_global fails"
  test_case:
  -
    input: "agent 001 syscheck integrity_check_global "
    output: "err Cannot perform range checksum"
    stage: "Syscheck integrity_check_global fail - no payload"
  -
    input: "agent 001 syscheck integrity_check_global {\"end\":\"/home/test/f2\",\"checksum\":\"1234\",\"id\":1}"
    output: "err Cannot perform range checksum"
    stage: "Syscheck integrity_check_global - no 'begin' field"
  -
    input: "agent 001 syscheck integrity_check_global {\"begin\":\"/home/test/f1\",\"checksum\":\"1234\",\"id\":1}"
    output: "err Cannot perform range checksum"
    stage: "Syscheck integrity_check_global - no 'end' field"
  -
    input: "agent 001 syscheck integrity_check_global {\"begin\":\"/home/test/f1\",\"end\":\"/home/test/f2\",\"id\":1}"
    output: "err Cannot perform range checksum"
    stage: "Syscheck integrity_check_global - no 'checksum' field"
  -
    input: "agent 001 syscheck integrity_check_global {\"begin\":\"/home/test/f1\",\"end\":\"/home/test/f2\",\"checksum\":\"1234\"}"
    output: "err Cannot perform range checksum"
    stage: "Syscheck integrity_check_global - no 'id' field"
-
  name: "Integrity_check_left success"
  description: "Integrity_check_left success"
  test_case:
  -
    input: "agent 001 syscheck save2 {\"path\":\"/home/test/file1\",\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
    output: "ok"
    stage: "Syscheck integrity_check_left preparation file1"
  -
    input: "agent 001 syscheck save2 {\"path\":\"/home/test/file2\",\"timestamp\":1575421292,\"attributes\":{\"type\":\"file\",\"size\":0,\"perm\":\"rw-r--r--\",\"uid\":\"0\",\"gid\":\"0\",\"user_name\":\"root\",\"group_name\":\"root\",\"inode\":16879,\"mtime\":1575421292,\"hash_md5\":\"d41d8cd98f00b204e9800998ecf8427e\",\"hash_sha1\":\"da39a3ee5e6b4b0d3255bfef95601890afd80709\",\"hash_sha256\":\"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\",\"checksum\":\"f65b9f66c5ef257a7566b98e862732640d502b6f\"}}"
    output: "ok"
    stage: "Syscheck integrity_check_left preparation file2"
  -
    input: "agent 001 syscheck integrity_check_left {\"begin\":\"/home/test/file1\",\"end\":\"/home/test/file2\",\"checksum\":\"2a41be94762b4dc57d98e8262e85f0b90917d6be\",\"id\":1}"
    output: "ok "
    stage: "Syscheck integrity_check_left success - no tail"
  -
    input: "agent 001 syscheck integrity_check_left {\"begin\":\"/home/test/file1\",\"end\":\"/home/test/file2\",\"checksum\":\"2a41be94762b4dc57d98e8262e85f0b90917d6be\",\"id\":1,\"tail\":3}"
    output: "ok "
    stage: "Syscheck integrity_check_left success - tail"
  -
    input: "agent 001 syscheck integrity_check_left {\"begin\":\"/home/test/file1\",\"end\":\"/home/test/file2\",\"checksum\":\"asdf1234\",\"id\":1}"
    output: "ok checksum_fail"
    stage: "Syscheck integrity_check_left fail - checksum_fail"
  -
    input: "agent 001 syscheck integrity_check_left {\"begin\":\"/home/test/f1\",\"end\":\"/home/test/f2\",\"checksum\":\"1234\",\"id\":1}"
    output: "ok no_data"
    stage: "Syscheck integrity_check_left success - no data"
-
  name: "Integrity_check_left fails"
  description: "Integrity_check_left fails"
  test_case:
  -
    input: "agent 001 syscheck integrity_check_left "
    output: "err Cannot perform range checksum"
    stage: "Syscheck integrity_check_left fail - no payload"
  -
    input: "agent 001 syscheck integrity_check_left {\"end\":\"/home/test/f2\",\"checksum\":\"1234\",\"id\":1}"
    output: "err Cannot perform range checksum"
    stage: "Syscheck integrity_check_left - no 'begin' field"
  -
    input: "agent 001 syscheck integrity_check_left {\"begin\":\"/home/test/f1\",\"checksum\":\"1234\",\"id\":1}"
    output: "err Cannot perform range checksum"
    stage: "Syscheck integrity_check_left - no 'end' field"
  -
    input: "agent 001 syscheck integrity_check_left {\"begin\":\"/home/test/f1\",\"end\":\"/home/test/f2\",\"id\":1}"
    output: "err Cannot perform range checksum"
    stage: "Syscheck integrity_check_left - no 'checksum' field"
  -
    input: "agent 001 syscheck integrity_check_left {\"begin\":\"/home/test/f1\",\"end\":\"/home/test/f2\",\"checksum\":\"1234\"}"
    output: "err Cannot perform range checksum"
    stage: "Syscheck integrity_check_left - no 'id' field"
-
  name: "Integrity clear success"
  description: "Integrity_check_left fails"
  test_case:
  -
    input: "agent 001 syscheck integrity_clear {\"id\":1}"
    output: "ok "
    stage: "Syscheck integrity_clear success"
-
  name: "Integrity_clear fails"
  description: "Integrity_clear fails"
  test_case:
  -
    input: "agent 001 syscheck integrity_clear "
    output: "err Cannot perform range checksum"
    stage: "Syscheck integrity_clear fail - no payload"
  -
    input: "agent 001 syscheck integrity_clear {}"
    output: "err Cannot perform range checksum"
    stage: "Syscheck integrity_clear fail - no id"
-
  name: "Invalid agent ID"
  description: "The syntax for every query for Wazuh DB is agent {ID} {component} {query}. This section covers the dealing with unexpected values of the agent ID."
  test_case:
  -
    input: "agent fake_id syscheck integrity_clear {\"id\":1}"
    output: "err Invalid agent ID 'fake_id'"
    stage: "Syscheck - Invalid agent ID"
  -
    input: "agent syscheck integrity_clear {\"id\":1}"
    output: "err Invalid agent ID 'syscheck'"
    stage: "Syscheck - Missing agent ID (one space)"
  -
    input: "agent  syscheck integrity_clear {\"id\":1}"
    output: "ok "
    stage: "Syscheck - Missing agent ID (two spaces)"
  -
    input: "agent   syscheck integrity_clear {\"id\":1}"
    output: "err Invalid DB query syntax, near ''"
    stage: "Syscheck - Missing agent ID (three spaces)"
  -
    input: "agent 1 syscheck integrity_clear {\"id\":1}"
    output: "ok "
    stage: "Syscheck - Less than three digits for the agent ID"
-
  name: "Create agent"
  description: "Wazuh DB creates automatically the agent's database the first time a query with a new agent ID reaches it. Once the database is created, the query is processed as expected."
  test_case:
  -
    input: "agent 999 syscheck integrity_check_left"
    output: "err Invalid FIM query syntax, near 'integrity_check_left'"
    stage: "Syscheck - Agent does not exits yet"
