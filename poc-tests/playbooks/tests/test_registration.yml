- hosts: all
  become: true
  vars:
    path: "/tmp"
    test_directory: "tests"
    test_file: "test_registration.py"
    curl_path: /usr/bin/curl

  tasks:
    - name: Test registration - Wazuh agent
      command: "pytest {{ test_file }} --target=agent -v"
      args:
        chdir: "{{ path }}/{{ test_directory }}"
      when: "'Agent' in inventory_hostname"

    - name: Test registration - Wazuh manager
      command: "pytest {{ test_file }} --target=server -v"
      args:
        chdir: "{{ path }}/{{ test_directory }}"
      when: "'Manager' in inventory_hostname"
