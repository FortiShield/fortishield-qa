- name: Install packages
  command: apt-get -y install gnupg apt-transport-https
  when: ansible_os_family == "Debian"

- name: Install GPG key
  shell: "curl -s https://packages.wazuh.com/key/GPG-KEY-WAZUH | gpg --no-default-keyring --keyring gnupg-ring:/usr/share/keyrings/wazuh.gpg --import && chmod 644 /usr/share/keyrings/wazuh.gpg"
  when: ansible_os_family == "Debian"

- name: Add Wazuh repository
  shell: "echo \"deb [signed-by=/usr/share/keyrings/wazuh.gpg] https://packages.wazuh.com/4.x/apt/ stable main\" | tee -a /etc/apt/sources.list.d/wazuh.list"
  when: ansible_os_family == "Debian"

- name: Update package information
  command: "apt-get update"
  when: ansible_os_family == "Debian"

- name: Import the GPG key
  command: "rpm --import https://packages.wazuh.com/key/GPG-KEY-WAZUH"
  when: ansible_os_family == "RedHat"

- name: Add Wazuh repository
  shell: "echo -e '[wazuh]\ngpgcheck=1\ngpgkey=https://packages.wazuh.com/key/GPG-KEY-WAZUH\nenabled=1\nname=EL-$releasever - Wazuh\nbaseurl=https://packages.wazuh.com/4.x/yum/\nprotect=1' | tee /etc/yum.repos.d/wazuh.repo"
  when: ansible_os_family == "RedHat"
